- name: Deploy via SSH
  uses: appleboy/ssh-action@v1.0.3
  with:
    host: 13.62.72.179
    username: ubuntu
    key: ${{ secrets.SSH_PRIVATE_KEY }}
    port: 22
    script_stop: true
    debug: true
    script: |
      set -e
      echo "ğŸ“ Moving to project directory"
      cd /home/ubuntu/marketpulse

      echo "ğŸ”„ Fetching latest code"
      git fetch origin
      git reset --hard origin/main

      echo "ğŸ Activating virtualenv"
      source venv/bin/activate

      echo "ğŸ“¦ Installing requirements"
      pip install -r requirements.txt

      echo "ğŸ§¬ Running migrations"
      python manage.py migrate

      echo "ğŸ¨ Collecting static files"
      python manage.py collectstatic --noinput

      echo "ğŸš€ Restarting Gunicorn"
      sudo systemctl restart gunicorn

      echo "âš™ï¸ Restarting Celery Worker"
      sudo systemctl restart celery-worker

      echo "â° Restarting Celery Beat"
      sudo systemctl restart celery-beat

      echo "âœ… Deployment completed successfully!"
